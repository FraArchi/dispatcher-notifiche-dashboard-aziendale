---
phase: 02-blocking-ui-multimedia
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [dispatcher.html]
autonomous: true
requirements: [FR-4, FR-5]
must_haves:
  truths:
    - "A fullscreen 'Portal-style' overlay blocks interaction when active"
    - "A 'System Start' screen appears initially to unlock Web Audio"
    - "A 60-second countdown bar animates smoothly using WAAPI"
  artifacts:
    - path: "dispatcher.html"
      provides: "Refined CSS and WAAPI countdown logic"
  key_links:
    - from: "triggerAlertSequence"
      to: "WAAPI Animation"
      via: "Element.animate()"
---

<objective>
Refine the notification UI into a high-impact 'Portal-style' overlay and implement a precision 60-second countdown using the Web Animations API (WAAPI). 

Purpose: Ensure the notification is impossible to ignore and provides clear visual feedback of the remaining time for action.
Output: Updated dispatcher.html with modern CSS layout and high-performance animations.
</objective>

<execution_context>
@/home/laboratorio/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-blocking-ui-multimedia/02-RESEARCH.md
@dispatcher.html

<interfaces>
Existing DOM elements:
- #alert-view (overlay)
- #alert-countdown (bar)
- #btn-test-ui (test trigger)

State:
- state.isAlertActive (boolean)
- state.currentAlertTicket (object)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Portal-style Overlay CSS</name>
  <files>dispatcher.html</files>
  <action>
    - Refactor #alert-view styles to use Pattern 2 from Research: `position: fixed`, `inset: 0`, `height: 100dvh`, and `z-index: 9999`.
    - Improve the "Red Alert" aesthetics: use high-contrast backgrounds (dark overlay with neon red accents).
    - Implement a "System Boot / Audio Unlock" modal that covers the screen on load. This is mandatory for the browser's Autoplay Policy.
    - Ensure the overlay handles different screen sizes gracefully (responsive grid/flex).
  </action>
  <verify>Open dispatcher.html, click 'Test Alert UI', verify it covers the entire screen including taskbars (if in fullscreen) and prevents interaction with underlying elements.</verify>
  <done>Overlay is fullscreen, visually striking, and includes an initial user-interaction gate.</done>
</task>

<task type="auto">
  <name>Task 2: Implement WAAPI Countdown</name>
  <files>dispatcher.html</files>
  <action>
    - Replace the CSS `transition` logic for #alert-countdown in `triggerAlertSequence`.
    - Use `Element.animate()` (Web Animations API) to scale the bar from 100% to 0% over exactly 60,000ms.
    - Ensure the animation is paused/cancelled when the ticket is acknowledged.
    - Store the animation reference in the `state` object for control.
    - Avoid `setInterval` or CSS transitions for the countdown to prevent drift and performance issues.
  </action>
  <verify>Trigger an alert, verify the bar moves smoothly and reaches 0 exactly when 60s pass. Use browser devtools to check if it's a 'Web Animation'.</verify>
  <done>Countdown bar is controlled by WAAPI and resets correctly on acknowledgment.</done>
</task>

</tasks>

<verification>
1. Refresh the page: Does the "Unlock Audio" screen appear?
2. Click "Test Alert UI": Does the overlay block everything?
3. Observe the bar: Is it moving smoothly for 60 seconds?
</verification>

<success_criteria>
- Overlay uses modern CSS units (dvh, inset).
- Animation uses WAAPI (no CSS transitions for the timer).
- Page requires interaction before showing the main dashboard.
</success_criteria>

<output>
After completion, create `.planning/phases/02-blocking-ui-multimedia/02-01-SUMMARY.md`
</output>
