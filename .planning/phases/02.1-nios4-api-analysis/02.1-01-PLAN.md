---
phase: 02.1-nios4-api-analysis
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [Nios4Utility.js, Nios4Client.js]
autonomous: true
requirements: [FR-1]
must_haves:
  truths:
    - "Nios4Utility generates valid TIDs (YYYYMMDDHHMMSS)"
    - "Nios4Utility generates valid UUID v4 (GGUID)"
    - "Nios4Client can perform login, get_record, find_records, and save_record"
  artifacts:
    - path: "Nios4Utility.js"
      provides: "TID and GGUID generation"
      exports: ["tid", "gguid"]
    - path: "Nios4Client.js"
      provides: "Nios4 API client class"
      contains: "class Nios4Client"
  key_links:
    - from: "Nios4Client.js"
      to: "Nios4Utility.js"
      via: "require"
      pattern: "require\(['"]./Nios4Utility['"]\)"
---

<objective>
Implement the core Nios4 SDK utilities and the client class to encapsulate API logic.
This provides a clean interface for Nios4 operations, moving away from raw axios calls.
</objective>

<execution_context>
@/home/laboratorio/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/02.1-nios4-api-analysis/02.1-RESEARCH.md
@test-nios-api.js
</context>

<tasks>

<task type="auto">
  <name>Create Nios4Utility.js</name>
  <files>Nios4Utility.js</files>
  <action>
    Create a utility module that exports two functions:
    1. `tid()`: Returns a numeric string in `YYYYMMDDHHMMSS` format (UTC).
    2. `gguid()`: Returns a UUID v4 string using `crypto.randomUUID()`.
    
    Ensure `tid()` correctly pads single-digit months, days, hours, etc.
  </action>
  <verify>
    Run a small Node.js script to log `tid()` and `gguid()` and verify formats:
    `node -e "const u = require('./Nios4Utility'); console.log(u.tid(), u.gguid())"`
  </verify>
  <done>
    `Nios4Utility.js` exists and exports both functions with correct output formats.
  </done>
</task>

<task type="auto">
  <name>Create Nios4Client.js</name>
  <files>Nios4Client.js</files>
  <action>
    Implement a `Nios4Client` class using `axios`.
    The constructor should accept `{ baseUrl, database, token }`.
    
    Implement the following methods:
    1. `login(username, password)`: Placeholder or implementation for obtaining a token (if token not provided). If token exists, just verify connectivity.
    2. `get_record(tablename, gguid)`: GET request to `/model` with `database`, `table`, and `filter=gguid='{gguid}'`.
    3. `find_records(tablename, filter)`: GET request to `/model` with `database`, `table`, and optional `filter`.
    4. `save_record(tablename, record, is_new)`: POST request to `/model` (or correct endpoint based on research). If `is_new`, ensure a `gguid` and `tid` are assigned using `Nios4Utility`.
    
    Use `Bearer` authentication in headers.
  </action>
  <verify>
    Run a unit test (mocked or actual if env vars available) to ensure class instantiation and method signatures.
  </verify>
  <done>
    `Nios4Client.js` is implemented and handles core Nios4 model operations.
  </done>
</task>

</tasks>

<verification>
- `Nios4Utility.js` generates correct TID and GGUID.
- `Nios4Client.js` correctly formats requests for `/model` endpoint.
</verification>

<success_criteria>
- Both files created and functional.
- `Nios4Client` successfully encapsulates the logic previously found in `test-nios-api.js`.
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-nios4-api-analysis/02.1-01-SUMMARY.md`
</output>
