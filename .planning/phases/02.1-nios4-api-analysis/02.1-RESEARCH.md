# RESEARCH: Nios4 API Integration Analysis

## Overview
The discovered repositories (`sync_nios4` and `api_nios4`) provide a Python-based implementation for interacting with the Nios4 Web API and MySQL synchronization. 

## Key Technical Insights
1. **API Endpoints:**
   - The `api_nios4.py` confirms that the base URL is indeed `https://web.nios4.com/ws`.
   - Methods like `get_record`, `find_records`, and `save_record` use paths like `/model`.
   - Authentication can be done via `Bearer` token or query parameter `token`.

2. **Data Normalization (TID/GGUID):**
   - **TID (Time Identifier):** An integer formatted as `YYYYMMDDHHMMSS` in UTC. This is critical for Nios4's internal sync and ordering.
   - **GGUID:** Standard UUID v4 strings, generated client-side for new records.

3. **Core API Operations:**
   - **Querying:** Uses `filter` parameters with SQL-like syntax (e.g., `stato='Aperto'`).
   - **Saving:** `save_record` sends JSON payloads.
   - **Sync:** A specific `/sync` endpoint triggers delivery of changes to other devices.

4. **MySQL Sync Logic:**
   - The `sync_nios4` library manages local MySQL tables that mirror Nios4 structures. This might be useful if we decide to keep a local cache, but our primary focus is the Web API.

## Strategic Adaptation for Node.js
- **TID Generator:** Implement a utility in `server.js` to generate TIDs in `YYYYMMDDHHMMSS` format.
- **Request Pattern:** Use `axios` in Node.js to mimic the Python `requests` calls, ensuring we include `database`, `table`, and `filter` correctly.
- **Deep-linking:** Confirmed pattern `https://web.dtec.one/scheda/{gguid}`.

## Decision
We will not switch to Python. Instead, we will implement a `Nios4Client` class in Node.js that implements the same logic (TID generation, token-based requests, payload structure) as found in the Python wrapper.
